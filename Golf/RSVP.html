<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>RSVP</title>
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="assets/styles/style.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="assets/styles/bootstrap.css" />
    <style>
        /* Sticky footer styles
        -------------------------------------------------- */

        html,
        body {
            height: 100%;
            /* The html and body elements cannot have any padding or margin. */
        }

        /* Wrapper for page content to push down footer */
        #wrap {
            min-height: 100%;
            height: auto !important;
            height: 100%;
            /* Negative indent footer by its height */
            margin: 0 auto -30px;
            /* Pad bottom by footer height */
            padding: 0 0 30px;
        }

        /* Set the fixed height of the footer here */
        #footer {
            height: 30px;
            background-color: #336600;
            color: white;
            text-align: center;
            padding: 5px;
        }


        /* Custom page CSS
        -------------------------------------------------- */
        /* Not required for template or sticky footer method. */

        #wrap > .container {
            padding: 30px 15px 0;
        }

        .container .credit {
            margin: 20px 0;
        }

        #footer > .container {
            padding-left: 15px;
            padding-right: 15px;
        }

        #rsvpAction {
            padding: 10px;
            text-align: center;
            background-color: #C1FFC1;
            -moz-border-radius: 5px;
            border-radius: 5px;
            -moz-box-shadow: 5px 5px 5px black;
            -webkit-box-shadow: 5px 5px 5px black;
            box-shadow: 5px 5px 5px black;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Wrap all page content here -->
    <div id="wrap">

        <!-- Fixed navbar -->
        <div class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#" id="ancPageTitle" style="width:100%;">RSVP</a>
                </div>
            </div>
        </div>

        <!-- Begin page content -->
        <div class="container">
            <div style="padding-top:15px; color:white;"><a id="ancHomeButton" style="color:white; text-decoration:none;"><i class="glyphicon glyphicon-home"></i>&nbsp;Home</a></div>
            <div id="rsvpAction">
                <table id="tblRSVPEmailSubmit" style="margin: 0 auto;">
                    <tr>
                        <td><b>Enter Email to RSVP for the Game</b></td>
                    </tr>
                    <tr>
                        <td style="padding: 15px 0px 0px 0px;">

                            <input type="text" style="width: 180px; height: 25px;" id="txtrsvpEmail" />&nbsp;

                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px 0px 5px 0px;">
                            <input type="checkbox" id="chkSaveEmail" />&nbsp;Save email on this device&nbsp;&nbsp;
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 15px 0px 0px 0px;"><a class="-button green" id="arsvpEmailSubmit" onclick="RSVPEmailSubmit();"><span class="-">Submit</span></a></td>

                    </tr>

                    <tr>
                        <td style="padding: 0; text-align:center; color: red;">
                            <div style="padding: 10px;  position: relative;  height:0;">
                                <label id="RsvpEmailError"></label>
                            </div>
                        </td>
                    </tr>
                </table>
                <div style="border: solid 1px #3D800C; padding: 10px; display: none;" id="divrsvpSubmit">
                    <a style="position: absolute; margin-top: -20px; margin-left: 120px; cursor: pointer;" onclick="RSVPSubmitCancel();">
                        <img src="assets/images/CloseSmall.png" />
                    </a>
                    <table style="margin: 0 auto;">
                        <tr>
                            <td></td>
                        </tr>
                        <tr>
                            <td>
                                <label id="lblRSVPPlayerInfo"></label>
                                <input type="hidden" id="hdnRSVPPlayerID" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <input type="radio" name="group2" value="Playing" id="rdPlaying" onclick="showHideGuest('true');">&nbsp;Playing&nbsp;&nbsp;
                                <input type="radio" name="group2" value="Not Playing" id="rdNotPlaying" onclick="showHideGuest('false');">&nbsp;Not Playing
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: left; display:none;" id="tdPlayingFields">

                                <fieldset style=" font-size:10px; width:98%;  padding: 10px 5px 5px 5px;">
                                    <div style=" font: bold 12px arial; ">Type:</div>
                                    <table cellpadding="0" cellspacing="0" style="width:100%;">
                                        <tr>
                                            <td><b>TeeOff:</b></td>
                                            <td style="padding-left: 5px;">
                                                <select id="txtRSVPTeeOff" style="width: 70px; font-size:10px;">
                                                    <option value="">--Select-- </option>
                                                    <option value="Early">Early</option>
                                                    <option value="Either">Either</option>
                                                    <option value="Late">Late</option>
                                                    <option value="After The Field">After the Field</option>
                                                </select>
                                                <!--   <input type="text" style="width: 70px; height: 10px;" id="txtEditProfileTeeOff" /></td>-->
                                            <td style="padding-left: 15px;"><b>TeeBox:</b></td>
                                            <td style="padding-left: 5px;">
                                                <!--                                            <input type="text" style="width: 70px; height: 10px;" id="txtEditProfileTeeBox" />-->
                                                <select id="txtRSVPTeeBox" style="width: 70px; font-size:10px;">
                                                    <option value="">--Select-- </option>
                                                    <option value="Black">Black</option>
                                                    <option value="Blue">Blue</option>
                                                    <option value="White">White</option>
                                                    <option value="Forward">Forward</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="margin-top: 10px;"><b>Risk:</b></td>
                                            <td style="padding-left: 5px;">
                                                <!--<input type="text" style="width: 70px; height: 10px;" id="txtEditProfileRisk" />-->
                                                <select id="txtRSVPRisk" style="width: 70px; font-size:10px;">
                                                    <option value="">--Select-- </option>
                                                    <option value="Low">Low</option>
                                                    <option value="Moderate">Moderate</option>
                                                    <option value="High">High</option>
                                                </select>

                                            </td>
                                            <td style="padding-left: 15px;"><b>Mode:</b></td>
                                            <td style="padding-left: 5px;">
                                                <!--  <input type="text" style="width: 70px; height: 10px;" id="txtEditProfileMode" />-->
                                                <select id="txtRSVPMode" style="width: 70px; font-size:10px;">
                                                    <option value="">--Select-- </option>
                                                    <option value="Walk">Walk</option>
                                                    <option value="Ride">Ride</option>
                                                    <option value="Either">Either</option>
                                                </select>
                                            </td>
                                        </tr>

                                    </table>

                                </fieldset>

                                <div id="divGuests" style=" width: 95%; margin: 5px;">
                                    <fieldset>
                                        <div style=" font: bold 12px arial; padding-top: 10px;">&nbsp;Guests&nbsp;</div>
                                        <table style="width: 100%; padding: 15px;">

                                            <tr>

                                                <td style="padding:5px;">
                                                    <input type="text" placeholder="Guest 1" style="width: 145px; height: 20px;" id="txtGuest1" />
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="padding:5px;">
                                                    <input type="text" placeholder="Guest 2" style="width: 145px; height: 20px;" id="txtGuest2" />
                                                </td>
                                            </tr>
                                        </table>
                                    </fieldset>

                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td style="text-align: center; padding-top: 15px;">
                                <a class="-button green" onclick="SubmitRSVP();"><span class="-">Submit</span></a>
                                <label style="color: red; margin-top: 5px;" id="rsvpError"></label>
                            </td>
                        </tr>

                    </table>

                </div>

            </div>
            <br />
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseOne">
                        <a data-toggle="collapse" data-parent="#accordion" data-target="#collapseOne" href="javascript:void(0)" style="text-decoration:none;">
                            <i class="indicator glyphicon glyphicon-chevron-up  pull-right"></i>
                            <h4 class="panel-title">
                                Game Info
                            </h4>
                        </a>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <table style=" padding: 20px; width: 100%; margin: 0 auto;">
                                <tr>
                                    <td><b>Captain:</b></td>
                                    <td>
                                        <label id="lblGameCaptain"></label>
                                    </td>
                                </tr>
                                <tr>
                                    <td><b>Game Date:</b></td>
                                    <td>
                                        <label id="lblGameDate"></label>

                                    </td>
                                </tr>
                                <tr>
                                    <td><b>Game Time:</b></td>
                                    <td>
                                        <label id="lblGameTime"></label>
                                    </td>
                                </tr>


                            </table>
                            <input type="hidden" id="hdnRSVPPopupGameId" />
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#collapseTwo">
                        <a data-toggle="collapse" data-parent="#accordion" data-target="#collapseTwo" href="javascript:void(0)" style="text-decoration:none;">
                            <i class="indicator glyphicon glyphicon-chevron-down  pull-right"></i>
                            <h4 class="panel-title">
                                Player Info
                            </h4>
                        </a>
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse">
                        <div class="panel-body">

                            <div class="panel-group" id="accordionPlayerInfo">
                                <div class="panel panel-default">
                                    <div class="panel-heading" data-toggle="collapse" data-parent="#accordionPlayerInfo" data-target="#collapseOnePlaying">
                                        <a data-toggle="collapse" data-parent="#accordionPlayerInfo" data-target="#collapseOnePlaying" href="javascript:void(0)">
                                            <i class="indicator glyphicon glyphicon-chevron-up  pull-right"></i>
                                            <h4 class="panel-title">
                                                <label id="lblPlayingPlayers"></label>
                                            </h4>
                                        </a>
                                    </div>
                                    <div id="collapseOnePlaying" class="panel-collapse collapse in">
                                        <div class="panel-body">
                                            <label id="lblPlayingPlayersDetail"></label>
                                        </div>
                                    </div>
                                    <div style="margin-top:5px;" class="panel-heading" data-toggle="collapse" data-parent="#accordionPlayerInfo" data-target="#collapseOneNotPlaying">
                                        <a data-toggle="collapse" data-parent="#accordionPlayerInfo" data-target="#collapseOneNotPlaying" href="javascript:void(0)">
                                            <i class="indicator glyphicon glyphicon-chevron-down  pull-right"></i>
                                            <h4 class="panel-title">
                                                <label id="lblNotPlayingPlayers"></label>
                                            </h4>
                                        </a>
                                    </div>
                                    <div id="collapseOneNotPlaying" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <label id="lblNotPlayingPlayersDetail"></label>
                                        </div>
                                    </div>
                                    <div style="margin-top:5px;" class="panel-heading" data-toggle="collapse" data-parent="#accordionPlayerInfo" data-target="#collapseOneNotResponded">
                                        <a data-toggle="collapse" data-parent="#accordionPlayerInfo" data-target="#collapseOneNotResponded" href="javascript:void(0)">
                                            <i class="indicator glyphicon glyphicon-chevron-down  pull-right"></i>
                                            <h4 class="panel-title">
                                                <label id="lblNotRespondedPlayers"></label>
                                            </h4>
                                        </a>
                                    </div>
                                    <div id="collapseOneNotResponded" class="panel-collapse collapse">
                                        <div class="panel-body">
                                            <label id="lblNotRespondedPlayersDetail"></label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <div id="footer">
        <div class="container">
            Designed By - Shobhit Kasliwal
        </div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
    <script type="text/javascript" src="assets/scripts/bootstrap.js"></script>
    <script type="text/javascript" src="assets/scripts/scripts.js"></script>
    <script type="text/javascript" src="assets/scripts/GeneralScript.js?v=1"></script>
    <script type="text/javascript">
        var APPLICATIONID = '4A1BD17C-50F5-4E51-8C3F-B161BAB5E411';
        $(document).ready(function () {
            var GameId;
            var vars = [], hash;
            var q = document.URL.split('?')[1];
            if (q != undefined) {
                q = q.split('&');
                for (var i = 0; i < q.length; i++) {
                    hash = q[i].split('=');
                    vars.push(hash[1]);
                    vars[hash[0]] = hash[1];
                }
            }
            GameId = vars['GameID'];
            $('#hdnRSVPPopupGameId').val(GameId);
            $('#accordion').on('hidden.bs.collapse', toggleChevron);
            $('#accordion').on('shown.bs.collapse', toggleChevron);
            PopulateRSVPPage();
            $('#ancHomeButton').click(function (e) {
                window.parent.hideMobileRSVPPOpup();
            });
        });

        function toggleChevron(e) {
            $(e.target)
                .prev('.panel-heading')
                .find("i.indicator")
                .toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
        }

        function PopulateRSVPPage() {
            var GameID = $('#hdnRSVPPopupGameId').val();
            $('#txtrsvpEmail').val('');
            $('#RsvpEmailError').html('');
            if ($.cookie("SSLEVIN_GolfRsvpEmail") != undefined) {
                $('#txtrsvpEmail').val($.cookie("SSLEVIN_GolfRsvpEmail"));
                $('#chkSaveEmail').attr('checked', 'checked');
            }
            $.ajax({
                type: "Post",
                url: 'Webservices/GolfService.asmx/Web_RetriveGameDetail',
                data: '{GameID:"' + GameID + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var obj = $.parseJSON(response.d);
                    var AttendingPlayers = '', NotAttendingPlayers = '', NotRespondedPlayers = '';
                    $.each(obj.Attending, function (i, val) {
                        if (val[0] != undefined && val[0] != null) {
                            AttendingPlayers += "<li>" + val[0] + "</li>";
                        }
                        if (val[1] != undefined && val[1] != null) {
                            NotAttendingPlayers += "<li>" + val[1] + "</li>";
                        }
                        if (val[2] != undefined && val[2] != null) {
                            NotRespondedPlayers += "<li>" + val[2] + "</li>";
                        }
                    });

                    var Gameinfo = obj.GameInfo;
                    $('#lblGameDate').html(Gameinfo[0][2]);
                    $('#lblGameTime').html(Gameinfo[0][3]);
                    if (Gameinfo[0][7] != undefined && Gameinfo[0][7] != null)
                        $('#lblGameCaptain').html(Gameinfo[0][7]);
                    else
                        $('#lblGameCaptain').html("N/A");

                    $('#lblPlayingPlayers').html(Gameinfo[0][4] + " - " + "<b>Playing</b>");
                    $('#lblPlayingPlayersDetail').html("<ul>" + AttendingPlayers + "</ul>");
                    $('#lblNotPlayingPlayers').html(Gameinfo[0][5] + " - " + "<b>Not Playing</b>");
                    $('#lblNotPlayingPlayersDetail').html("<ul>" + NotAttendingPlayers + "</ul>");
                    $('#lblNotRespondedPlayers').html(Gameinfo[0][6] + " - " + "<b>Not Responded</b>");
                    $('#lblNotRespondedPlayersDetail').html("<ul>" + NotRespondedPlayers + "</ul>");

                    if (isNaN(Date.parse(Gameinfo[0][2])) == false) {
                        var GameDate = new Date(Date.parse(Gameinfo[0][2]));
                        if (GameDate.valueOf() <= (new Date()).valueOf()) {
                            OpenPopup = false;
                        }
                    }


                    $('#txtrsvpEmail').focus();
                    $('#ancPageTitle').html("RSVP for " + Gameinfo[0][1]);
                    // $('#lblAttending').html(Gameinfo[0]);
                    //  new FixedColumns(oGameDetailTable);

                    $('#tblRSVPEmailSubmit').show();
                    $('#divrsvpSubmit').hide('blind');



                },
                error: function (xhr, status, error) {
                    alert(xhr.responseText);
                }
            });
        }

        function RSVPEmailSubmit() {
            var GameID = $('#hdnRSVPPopupGameId').val();
            $('#rsvpAction').showLoading();
            $('#rsvpError').html('');
            $('#RsvpEmailError').html('');
            $('#rdPlaying').removeAttr('checked');
            $('#rdNotPlaying').removeAttr('checked');
            $('#txtGuest1').val('');
            $('#txtGuest2').val('');
            $('#txtGuest1').watermark();
            $('#txtGuest2').watermark();
            $('#tdPlayingFields').hide();
            $.ajax({
                type: "Post",
                url: 'Webservices/GolfService.asmx/Web_ValidateRSVPEmail',
                data: '{EmailAddress:"' + $('#txtrsvpEmail').val() + '",GameId:"' + GameID + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    var obj = $.parseJSON(response.d);
                    var Message = obj[0]['MESSAGE'];
                    if (Message == "SUCCESS") {
                        $('#lblRSVPPlayerInfo').html("<b>Name:</b>&nbsp;&nbsp;" + obj[0]['NAME'] + "<br><b>Email:</b>&nbsp;&nbsp;" + obj[0]['Email']);
                        if (obj[0]['isPlaying'] != undefined && obj[0]['isPlaying'] != null) {
                            if (obj[0]['isPlaying'] == true) {
                                $('#rdPlaying').attr('checked', 'checked');
                                $('#divGuests').show();
                                var Guests = obj[0]['Guests'];
                                if (Guests.length > 0) {
                                    $('#txtGuest1').removeClass("marked");
                                    $('#txtGuest1').val(Guests.toString().split("|")[0]);
                                    if (Guests.toString().split("|").length > 1) {
                                        $('#txtGuest2').removeClass("marked");
                                        $('#txtGuest2').val(Guests.toString().split("|")[1]);
                                    }
                                }
                            }
                            else {
                                $('#rdNotPlaying').attr('checked', 'checked');
                                $('#divGuests').hide();
                            }
                        }
                        if (obj[0]['RSVP_TeeOff'] != undefined && obj[0]['RSVP_TeeOff'] != null) {
                            $('#txtRSVPTeeOff').val(obj[0]['RSVP_TeeOff']);
                        }
                        if (obj[0]['RSVP_TeeBox'] != undefined && obj[0]['RSVP_TeeBox'] != null) {
                            $('#txtRSVPTeeBox').val(obj[0]['RSVP_TeeBox']);
                        }
                        if (obj[0]['RSVP_Risk'] != undefined && obj[0]['RSVP_Risk'] != null) {
                            $('#txtRSVPRisk').val(obj[0]['RSVP_Risk']);
                        }
                        if (obj[0]['RSVP_Mode'] != undefined && obj[0]['RSVP_Mode'] != null) {
                            $('#txtRSVPMode').val(obj[0]['RSVP_Mode']);
                        }

                        $('#hdnRSVPPlayerID').val(obj[0]['PlayerID']);

                        $('#RsvpEmailError').html('');
                        if ($('#chkSaveEmail').attr('checked') == 'checked' || $('#chkSaveEmail').prop('checked') == true) {
                            $.cookie("SSLEVIN_GolfRsvpEmail", $('#txtrsvpEmail').val());
                        }
                        else {
                            $.cookie("SSLEVIN_GolfRsvpEmail", null);
                        }
                        setTimeout(function () {
                            $('#rsvpAction').hideLoading();
                            $('#tblRSVPEmailSubmit').hide();
                            $('#divrsvpSubmit').show('blind');
                        }, 500);
                    }
                    else {
                        $('#RsvpEmailError').html(Message);

                        $('#rsvpAction').hideLoading();


                    }

                },
                error: function (xhr, status, error) {
                    $('#RsvpEmailError').html("An error occured while processing.<br>Please contact system administrator.");
                    setTimeout(function () { $('#rsvpAction').hideLoading(); }, 500);
                }
            });

        }
        function RSVPSubmitCancel() {
            $('#tblRSVPEmailSubmit').show('blind');
            $('#divrsvpSubmit').hide();
        }
        function showHideGuest(show) {
            if (show.toString().toLowerCase() == 'true')
                $('#tdPlayingFields').show('blind');
            else
                $('#tdPlayingFields').hide('blind');
        }

        function SubmitRSVP() {
            var Guest1 = $('#txtGuest1').val();
            var Guest2 = $('#txtGuest2').val();
            var Guests = '';
            if (Guest1 == $('#txtGuest1').attr('title'))
                Guest1 = '';
            if (Guest2 == $('#txtGuest2').attr('title'))
                Guest2 = '';
            Guests += Guest1;
            Guests += (Guests.length > 0 && Guest2.length > 0 ? '|' : '') + Guest2;
            $('#rsvpAction').showLoading();
            var isPlaying;

            if ($('#rdPlaying').attr('checked') == "checked" || $('#rdPlaying').prop('checked') == true) {
                isPlaying = true;
            }
            if ($('#rdNotPlaying').attr('checked') == "checked" || $('#rdNotPlaying').prop('checked') == true) {
                isPlaying = false;
            }
            if (isPlaying == undefined || isPlaying == null) {
                $('#rsvpError').html("Please check an option.");
                return;
            }
            var RSVP_TeeOff, RSVP_TeeBox, RSVP_Risk, RSVP_Mode;
            RSVP_TeeOff = $('#txtRSVPTeeOff').val();
            RSVP_TeeBox = $('#txtRSVPTeeBox').val();
            RSVP_Risk = $('#txtRSVPRisk').val();
            RSVP_Mode = $('#txtRSVPMode').val();

            $.ajax({
                type: "Post",
                url: 'Webservices/GolfService.asmx/Web_RSVP_Game',
                data: '{PlayerId:"' + $('#hdnRSVPPlayerID').val() + '",GameId:"' + $('#hdnRSVPPopupGameId').val() + '",isPlaying:"' + isPlaying + '",Guests:"' + Guests + '",RSVP_TeeOff:"' + RSVP_TeeOff + '",RSVP_TeeBox:"' + RSVP_TeeBox + '",RSVP_Risk:"' + RSVP_Risk + '",RSVP_Mode:"' + RSVP_Mode + '"}',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    setTimeout(function () {
                        $('#rsvpAction').hideLoading(); $('#tblRSVPEmailSubmit').show('blind');
                        $('#RsvpEmailError').html('<font color="green">Submitted Successfully !!! </font>');
                        $('#divrsvpSubmit').hide();
                        PopulateRSVPPage();
                    }, 500);
                },
                error: function (xhr, status, error) {
                    $('#RsvpEmailError').html("An error occured while processing.<br>Please contact system administrator.");
                    setTimeout(function () { $('#rsvpAction').hideLoading(); }, 500);
                }
            });
        }
    </script>


</body>
</html>
